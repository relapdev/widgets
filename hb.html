<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Relap HB</title>

    <style>
        #hbUrl {
            width: 100%;
        }

        .rangeValue {
            width: 100px;
        }

        .formWrapper {
            width: 400px;
            margin-bottom: 40px;
        }

        input {
            margin: 0;
            box-sizing: border-box;
        }

        input[type="range"] {
            width: 100%;
        }

        .rangeWrapper {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 10px 0
        }

        span {
            width: 10%;
        }
    </style>
</head>
<body>
<div class="formWrapper">
    <div>
        <input type="text" value="https://relap.io/hb/adfox/bid" id="hbUrl" />
    </div>
    <div class="rangeWrapper">
        <span>width:</span>
        <input
                type="range"
                min="100"
                max="1000"
                name="width"
                id="widgetWidth"
        />
        <input class="rangeValue" id="widthRangeValue" />
    </div>
    <div class="rangeWrapper">
        <span>height:</span>

        <input
                type="range"
                min="100"
                max="1000"
                name="height"
                id="widgetHeight"
        />
        <input  class="rangeValue" id="heightRangeValue" />
    </div>
    <div>
        <button id="bidButton">Bid</button>
    </div>
</div>

<iframe id="iframe" style="border: 1px solid grey"></iframe>

<script>
    const INITIAL_WIDTH = 336;
    const INITIAL_HEIGHT = 280;

    const container = document.querySelector("#iframe");
    const hbUrlInput = document.querySelector("#hbUrl");
    const widgetWidthRange = document.querySelector("#widgetWidth");
    const widgetHeightRange = document.querySelector("#widgetHeight");
    const widthRangeValue = document.querySelector("#widthRangeValue");
    const heightRangeValue = document.querySelector("#heightRangeValue");
    const iframe = document.querySelector("#iframe");
    const bidButton = document.querySelector("#bidButton");

    let width = INITIAL_WIDTH;
    let height = INITIAL_HEIGHT;

    const px = (value) => `${value}px`;

    const updateSize = ({ w = null, h = null } = {}) => {
        const newWidth = w || width;
        const newHeight = h || height;

        container.style.width = px(newWidth);
        container.style.height = px(newHeight);

        widthRangeValue.value = newWidth;
        widgetWidthRange.value = newWidth;

        heightRangeValue.value = newHeight;
        widgetHeightRange.value = newHeight;

        width = newWidth;
        height = newHeight;
    };

    widgetWidthRange.addEventListener("change", ({ target: { value } }) => {
        console.log("!!!!! value", value);
        updateSize({ w: value });
    });

    widgetHeightRange.addEventListener("change", ({ target: { value } }) => {
        console.log("!!!!! value", value);
        updateSize({ h: value });
    });

    widthRangeValue.addEventListener("change", ({ target: { value } }) => {
        console.log("!!!!! value", value);
        updateSize({ w: value });
    });

    heightRangeValue.addEventListener("change", ({ target: { value } }) => {
        console.log("!!!!! value", value);
        updateSize({ h: value });
    });

    // ----------

    const bid = () => {
        const url = hbUrlInput.value;
        const body = {
            places: [
                {
                    id: "adfox_bot1",
                    placementId: "Nco1zA3NiM40o8fH",
                    sizes: [[Number(width), Number(height)]],
                },
            ],
            settings: {
                currency: "RUB",
                windowSize: {
                    width: window.innerWidth,
                    height: window.innerHeight,
                },
            },
        };
        fetch(url, {
            method: "POST",
            body: JSON.stringify(body),
        })
            .then((res) => res.json())
            .then(({ bids }) => {
                console.log("!!!!! bids", bids);

                iframe.srcdoc = bids[0]?.displayCode;
            });
    };

    updateSize();

    bidButton.addEventListener("click", bid);
</script>
</body>
</html>
